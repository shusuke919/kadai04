<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<title>Firebase:v9:Chatã‚¢ãƒ—ãƒª</title>
<link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
<main>
<div>
    <div> åå‰ï¼š<input type="text" id="uname"> </div>
    <div>
        <textarea id="text" cols="30" rows="10"></textarea>
        <button id="send">é€ä¿¡</button>
        
       
    </div>
    <div id="output"></div>
</div>

</main>
<!--/ ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->



<!-- JQuery -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<!-- JQuery -->


<!--** ä»¥ä¸‹Firebase **-->
<script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
    import {
      getDatabase,
      ref,
      push,
      set,
      onChildAdded,
      remove,
      onChildRemoved,
    } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";
    // Your web app's Firebase configuration
   const firebaseConfig = {
  apiKey: "AIzaSyDKJZItBdx45d_9e3otQatcxWRJIjTquwM",
  authDomain: "gs23-e7946.firebaseapp.com",
  projectId: "gs23-e7946",
  storageBucket: "gs23-e7946.appspot.com",
  messagingSenderId: "404238532520",
  appId: "1:404238532520:web:41a512e3080bce32a1679d"
};

const app = initializeApp(firebaseConfig);
const db  = getDatabase(app); //RealtimeDBã«æ¥ç¶š
const dbRef = ref(db,"æ—¥è¨˜"); //RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†


//é€ä¿¡ã®ãƒœã‚¿ãƒ³ãŒæŠ¼ã•ã‚ŒãŸã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²ã™ã‚‹å‡¦ç†ã‚’æ›¸ãã¾ã™

$('#send').on("click", function(){

const unameValue = $("#uname").val();
const text = $("#text").val();

//å¿…ãšï¼å…¥åŠ›ã•ã‚ŒãŸã‚‚ã®ãŒå–å¾—ã§ãã¦ã„ã‚‹ã‹ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã€€ãƒ­ã‚°ã‚’ä½¿ã£ã¦ç¢ºèªã™ã‚‹ï¼ï¼

console.log(unameValue, 'åå‰');
console.log(text, 'ãƒ†ã‚­ã‚¹ãƒˆ');


//ãƒ‡ãƒ¼ã‚¿ã®å¡Šã‚’ä½œã‚‹

const msg = {
    uname: unameValue,
    text: text,
}

const newPostRef = push(dbRef);
set(newPostRef, msg);

//å…¥åŠ›æ¬„ã‚’ç©ºã«ã™ã‚‹
$("#uname").val("");//ç©ºã«ã™ã‚‹
$("#text").val("");//ç©ºã«ã™ã‚‹

//ã“ã®ä¸‹ã¯æ¶ˆã•ãªã„
});

  // å—ä¿¡å‡¦ç†ã‚’è¨˜è¿°ã—ã¾ã™ğŸ¤—
  onChildAdded(dbRef, function (data) {
        const msg = data.val();
        const key = data.key;
        console.log(msg, "dataã‚’å–å¾—");
        console.log(key, "éµã‚’å–å¾—");

        let html = `
        <div class="${key}">
            <p>${msg.uname}</p>
            <p>${msg.text}</p>
            <input type="button" value="å‰Šé™¤" class="delete">
            <input type="button" value="æ›´æ–°" class="update">
            </div>
          `;

        $("#output").append(html);
      });
  

      //ã‚¨ãƒ³ã‚¿ãƒ¼ã‚­ãƒ¼ã‚’æŠ¼ã—ãŸã‚‰é€ä¿¡
      $("#text").on("keydown", function (e){
        console.log(e, "eventã ã‚ˆ");

        if(e.keyCode === 13){

            const unameValue = $("#uname").val();
const text = $("#text").val();

//å¿…ãšï¼å…¥åŠ›ã•ã‚ŒãŸã‚‚ã®ãŒå–å¾—ã§ãã¦ã„ã‚‹ã‹ã€ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã€€ãƒ­ã‚°ã‚’ä½¿ã£ã¦ç¢ºèªã™ã‚‹ï¼ï¼

console.log(unameValue, 'åå‰');
console.log(text, 'ãƒ†ã‚­ã‚¹ãƒˆ');


//ãƒ‡ãƒ¼ã‚¿ã®å¡Šã‚’ä½œã‚‹

const msg = {
    uname: unameValue,
    text: text,
}

const newPostRef = push(dbRef);
set(newPostRef, msg);

//å…¥åŠ›æ¬„ã‚’ç©ºã«ã™ã‚‹
$("#uname").val("");//ç©ºã«ã™ã‚‹
$("#text").val("");//ç©ºã«ã™ã‚‹


        }


      });


      //å…¨å‰Šé™¤æ©Ÿèƒ½
    //   $(document).on("click",".delete", function(){
    //     const deleteKey = $(this).parent().attr('class');ã€€
    //     //å‰Šé™¤ãƒœã‚¿ãƒ³ã®è¦ªDivã®å›ºæœ‰Classã‚’å–å¾—
    //     console.log(deleteKey);
    //     //ã¡ã‚ƒã‚“ã¨å–å¾—ã§ãã¦ã„ã‚‹ã“ã¨ã¯ç¢ºèªæ¸ˆã¿
    // //   remove(dbRef);
    // //   ã“ã‚Œã§ã¯å…¨éƒ¨æ¶ˆãˆã¦ã—ã¾ã†
    //   });

//1ä»¶ãšã¤å‰Šé™¤ã™ã‚‹æ©Ÿèƒ½
      $(document).on("click",".delete", function(){
ã€€ã€€const deleteKey = $(this).parent().attr('class');ã€€
    const dbRef = ref(db,`æ—¥è¨˜/${deleteKey}`);
	remove(dbRef);
});

//æ›´æ–°æ©Ÿèƒ½
$(document).on("click",".update", function(){
ã€€ã€€const updateKey = $(this).parent().attr('class');ã€€
console.log(updateKey);
$("#uname").val(updateKey);//ç©ºã«ã™ã‚‹
$("#text").val(updateKey);//ç©ºã«ã™ã‚‹
    






});


  </script>


</body>
</html>
































